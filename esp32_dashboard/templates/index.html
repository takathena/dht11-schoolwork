<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESP32 IoT Dashboard</title>

  <!-- Font, Tailwind, Chart.js, GSAP -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top left, #0a0a0a, #1c1c1e);
      color: #f5f5f7;
      overflow: hidden;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: space-between;
    }

    .glass {
      background: rgba(30, 30, 30, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .title-gradient {
      background: linear-gradient(to right, #7dd3fc, #3b82f6, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    th {
      color: #9ca3af;
      font-weight: 500;
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    /* ðŸŒ‘ Custom scrollbar (ChatGPT dark style) */
    .custom-scroll::-webkit-scrollbar {
      width: 10px;
    }

    .custom-scroll::-webkit-scrollbar-track {
      background: rgba(15, 15, 15, 0.7);
      border-radius: 10px;
    }

    .custom-scroll::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #2a2a2d, #3a3a3d);
      border-radius: 10px;
      border: 2px solid #1a1a1c;
      transition: background 0.3s;
    }

    .custom-scroll::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #4a4a4d, #5a5a5d);
    }

    .custom-scroll::-webkit-scrollbar-corner {
      background: #1a1a1c;
    }
  </style>
</head>

<body class="px-6 py-4">

  <!-- LEFT PANEL -->
  <div class="glass p-8 w-[28%] h-full flex flex-col justify-between fade-in">
    <div>
      <h1 class="text-3xl font-semibold title-gradient mb-4">ESP32 Dashboard</h1>
      <p class="text-gray-400 mb-6">Real-time distance monitoring</p>

      <div class="space-y-4">
        <div class="flex items-center justify-between"><span>Status:</span><span id="status" class="text-green-400">Connecting...</span></div>
        <div class="flex items-center justify-between"><span>Current Distance:</span><span id="distance" class="font-semibold text-blue-400">-- cm</span></div>
        <div class="flex items-center justify-between"><span>Average:</span><span id="average" class="text-emerald-400">-- cm</span></div>
        <div class="flex items-center justify-between"><span>Max:</span><span id="max" class="text-cyan-400">-- cm</span></div>
        <div class="flex items-center justify-between"><span>Min:</span><span id="min" class="text-cyan-400">-- cm</span></div>
        <div class="flex items-center justify-between"><span>Total Data:</span><span id="count" class="text-indigo-400">--</span></div>
      </div>
    </div>

    <footer class="text-gray-500 text-xs mt-6 text-center">
      Â© 2025 ESP32 IoT Dashboard
    </footer>
  </div>

  <!-- RIGHT PANEL -->
  <div class="glass p-6 w-[70%] h-full flex flex-col justify-between fade-in">
    <div class="flex justify-between mb-3">
      <h2 class="text-xl font-medium">Data Overview</h2>
      <p id="update" class="text-gray-500 text-sm">Last update: --:--:--</p>
    </div>

    <div class="flex justify-between items-center gap-6 h-[45%]">
      <div class="w-1/2 h-full flex items-center justify-center">
        <canvas id="lineChart" class="max-h-[95%] w-full rounded-xl"></canvas>
      </div>
      <div class="w-1/2 h-full flex items-center justify-center">
        <canvas id="barChart" class="max-h-[95%] w-full rounded-xl"></canvas>
      </div>
    </div>

    <!-- âœ… Tambahkan class custom-scroll -->
    <div class="mt-6 h-[40%] overflow-y-auto rounded-xl bg-black/20 p-4 custom-scroll">
      <h3 class="text-lg font-medium mb-3">Database Records</h3>
      <table id="data-table">
        <thead>
          <tr><th>ID</th><th>Value (cm)</th><th>Time</th></tr>
        </thead>
        <tbody id="table-body">
          <tr><td colspan="3" class="text-center text-gray-600">Loading data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- JS -->
  <script>
    const distanceElem = document.getElementById("distance");
    const avgElem = document.getElementById("average");
    const maxElem = document.getElementById("max");
    const minElem = document.getElementById("min");
    const countElem = document.getElementById("count");
    const statusElem = document.getElementById("status");
    const updateElem = document.getElementById("update");
    const tableBody = document.getElementById("table-body");

    const lineCtx = document.getElementById("lineChart").getContext("2d");
    const barCtx = document.getElementById("barChart").getContext("2d");

    const lineChart = new Chart(lineCtx, {
      type: "line",
      data: { labels: [], datasets: [{ label: "Distance (cm)", data: [], borderColor: "#3b82f6", borderWidth: 3, tension: 0.3, fill: { target: 'origin', above: 'rgba(59,130,246,0.1)' }, pointRadius: 0 }] },
      options: { plugins: { legend: { display: false } }, scales: { x: { grid: { color: "rgba(255,255,255,0.05)" } }, y: { beginAtZero: true } } }
    });

    const barChart = new Chart(barCtx, {
      type: "bar",
      data: { labels: [], datasets: [{ label: "Recent Data", data: [], backgroundColor: "rgba(147,197,253,0.8)", borderRadius: 6 }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });

    async function fetchData() {
      try {
        const res = await fetch("/data");
        const data = await res.json();

        distanceElem.textContent = data.jarak.toFixed(2) + " cm";
        avgElem.textContent = data.rata2.toFixed(2) + " cm";
        maxElem.textContent = Math.max(...data.history).toFixed(2) + " cm";
        minElem.textContent = Math.min(...data.history).toFixed(2) + " cm";
        countElem.textContent = data.history.length;
        statusElem.textContent = data.jarak >= 0 ? "Connected" : "Disconnected";
        statusElem.className = data.jarak >= 0 ? "text-green-400" : "text-red-400";
        updateElem.textContent = "Last update: " + new Date().toLocaleTimeString();

        const labels = data.history.map((_, i) => i + 1);
        lineChart.data.labels = labels;
        barChart.data.labels = labels;
        lineChart.data.datasets[0].data = data.history;
        barChart.data.datasets[0].data = data.history;
        lineChart.update();
        barChart.update();

        tableBody.innerHTML = "";
        data.records.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${row.id}</td><td>${row.nilai.toFixed(2)}</td><td>${row.waktu}</td>`;
          tableBody.appendChild(tr);
        });

        gsap.to(distanceElem, { scale: 1.05, duration: 0.3, yoyo: true, repeat: 1 });
      } catch (err) {
        statusElem.textContent = "Disconnected";
        statusElem.className = "text-red-400";
      }
    }

    gsap.fromTo(".fade-in", { opacity: 0, y: 40 }, { opacity: 1, y: 0, duration: 1, stagger: 0.2 });
    fetchData();
    setInterval(fetchData, 2000);
  </script>
</body>
</html>
